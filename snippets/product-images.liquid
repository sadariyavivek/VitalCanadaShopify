<style>
  .carousel {
    margin-bottom: 40px;
  }

  .carousel-cell {
    width: 90%;
    height: 250px;
    margin-right: 10px;
    border-radius: 5px;
    counter-increment: carousel-cell;
  }

  .carousel-nav .carousel-cell {
    height: 250px;
    width: 30%;
  }
  
  .gallery-wrap {
    display: flex;
    flex-direction: row;
    height: max-content;
  }

  .product_gallery {
    max-width: 60%;
    width: 80%;
    margin-left: auto;
    margin-right: auto;
    height: max-content;
  }

  .product_gallery img {
    border-radius: 0;
  }
  
  .new-thumbnails {
    width: 20%;
  	height: 100%;
  }
  
  .thumbnail-image-container {
    width: 60px;
    margin-left: auto;
    margin-right: auto;
    height: 60px;
    margin-bottom: 20px;
    border-radius: 100%;
    background-size: cover;
    background-position: 50%;
    background-repeat: no-repeat;
    border: 3px solid white;
    transition: .15s all ease-out ;
    padding-top: 20px;
    padding-bottom: 20px;
	display: block;
    display: none;
  }
  
  .thumbnail-image-container:hover {
    
    cursor: pointer;
    border: 3px solid #23b6e6;
    {% if product.metafields.vital.secondary_color %} border-color: {{ product.metafields.vital.secondary_color }}; {% endif %}
  }
  
  .thumbnail-image-container.is-active {
    border: 3px solid #23b6e6;
    {% if product.metafields.vital.secondary_color %} border-color: {{ product.metafields.vital.secondary_color }}; {% endif %}
  }
  
  
  @media screen and (max-width: 800px) {
    .new-thumbnails {
      display: none;
    }
    
    .product_gallery .flickity-page-dots {
      display: block;
    }
  }

  @media screen and (min-width: 800px) and (max-width: 1200px){
    .pdp-redesign-wrapper .js-product_section{
      padding-left: 20px;
    }
  }

  .square-thumbnails .new-thumbnails{
    display: flex !important;
    justify-content: start !important;
  }
  
  .square-thumbnails .thumbnail-image-container{
    width: 41px !important;
    height: 41px !important;
    padding: 0 !important;
    border-radius: 0 !important;
    margin-left: 0 !important;
    margin-right: 2px !important;
    position: relative;
  }

  .square-thumbnails .thumbnail-image-container.video-icon:after{
    content: '';
    width: 70%;
    height: 70%;
    background-image: url('{{ 'play-icon.svg' | asset_url }}');
    background-size: contain;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
  }

  .thumbnail-image-container svg{
    display: none;
  }

  @media screen and (max-width: 800px){
    .square-thumbnails .flickity-page-dots{
      display: none !important;
    }
    .square-thumbnails.gallery-wrap{
      flex-direction: column !important;
    }

    .square-thumbnails .product_gallery{
      margin-bottom: 15px !important;
    }

    .square-thumbnails .new-thumbnails{
      width: 100% !important;
      order: 2;
      justify-content: center !important;
    }

    .square-thumbnails .thumbnail-image-container{
      font-size: 10px;
      width: auto !important;
      height: auto !important;
      color: #CDD2D5;
      margin-right: 8px !important;
      border: 0 !important;
      background-image: none !important;
    }

    .square-thumbnails .thumbnail-image-container.video-icon{
      font-size: 20px;
      margin-right: 2px !important;
      margin-left: -5px !important;
    }

    .square-thumbnails .thumbnail-image-container.is-active{
      color: #23b6e6;
    }

    .square-thumbnails .thumbnail-image-container svg{
      display: inline;
    }
  }

  @media screen and (min-width: 1201px){
    .square-thumbnails .thumbnail-image-container{
      width: 60px !important;
      height: 60px !important;
      margin-right: 5px !important;
    }
  }

  .square-thumbnails .video-play-button{
    background-image: url('{{ 'play-icon.svg' | asset_url }}');
    background-size: contain;
    position: absolute;
    top: 50%;
    left: 50%;
    width: 75px;
    height: 75px;
    transform: translate(-50%, -50%);
    cursor: pointer;
  }

  .square-thumbnails .product_gallery .flickity-prev-next-button{
    top: 50% !important;
    transform: translateY(-50%) !important;
  }

  .square-thumbnails .product_gallery .flickity-prev-next-button.previous{
    left: 30px !important;
  }

  .square-thumbnails .product_gallery .flickity-prev-next-button.next{
    right: 30px !important;
  }

  .pdp-redesign-wrapper .product-form-info-images-wrapper .square-thumbnails .product_gallery .gallery-cell{
    padding-left: 0;
    padding-right: 0;
  }

  .square-thumbnails .product_gallery{
    max-width: 100% !important;
    width: 100% !important;
    margin-left: 0 !important;
    margin-right: 0 !important;
  }

  @media screen and (min-width: 801px) {
    .square-thumbnails .product_gallery{
      margin-top: 30px;
      max-width: 90% !important;
      width: 90% !important;
      margin-bottom: 20px !important;
      margin-right: 50px !important;
    }
  }

  .square-thumbnails .product_gallery .image__container{
    width: 100% !important;
    padding-top: 80%;
    position: relative;
  }

  .square-thumbnails .product_gallery .image__container > *{
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
  }

  .square-thumbnails .product_gallery .image__container > div{
    width: 100%;
  }

  .square-thumbnails .product_gallery .image__container > img{
    width: auto !important;
    height: 100% !important;
  }

  .square-thumbnails .product_gallery video{
    width: 100%;
  }

  .square-thumbnails .product-form-info-images-wrapper{
    padding: 0 !important;
  }

  .square-thumbnails .title-price-review-badge-wrapper.mobile-show{
    padding: 10px 20px;
  }

  .square-thumbnails *::-webkit-media-controls-start-playback-button {
    display: none!important;
    -webkit-appearance: none;
  }

</style>
{% assign featured_image = product.selected_or_first_available_variant.featured_image | default: product.featured_image %}
  {% capture list %}
    {% for image in product.media %}
      {% comment %}Loop through images only once{% endcomment %}
      {% if image.media_type == "image" %}
      {{image.media_type}}`~`{{ image.id }}`~`{{ image.alt }}`~`{{ image | product_img_url: '100x' }}`~`{{ image | product_img_url: '200x' }}`~`{{ image | product_img_url: '400x' }}`~`{{ image | product_img_url: '600x' }}`~`{{ image | product_img_url: '800x' }}`~`{{ image | product_img_url: '1200x' }}`~`{{ image | product_img_url: '2000x' }}`~`{{-image.width-}}px`~`{{-image.height-}}px{% if forloop.last == false %}^{% endif %}
      {% elsif image.media_type == "video" %}
      {{image.media_type}}`~`{{ image.id }}`~`{{ image.alt }}`~``~`{{-image.width-}}px`~`{{-image.height-}}px{% if forloop.last == false %}^{% endif %}
      {% else %}
      {% endif %}
    {% endfor %}
  {% endcapture %}
  {% assign image_list = list | split: "^" %}

<div class="gallery-wrap js-product-page-gallery clearfix
            gallery-arrows--false
            {% if section.settings.product_thumbs %} {{ section.settings.thumbnail_position }} {% endif %}
            slideshow_animation--slide
            ">
  <div class="product_gallery product-{{ product.id }}-gallery
              {% if product.images.size > 1 %} multi-image {% endif %}
              {% if product.images.size <= 1 %} single-image {% endif %}
              {% if settings.slideshow_button_style != true %}light-button{% endif %}
              "
      data-zoom="{{ section.settings.activate_zoom }}"
      data-autoplay="{{ section.settings.activate_autoplay }}">

      {% for image_item in image_list %}
        {% assign image = image_item | split: "`~`" %}
        {% capture image_id %}{{ image[1] | strip }}{% endcapture %}
        {% capture image_alt %}{{ image[2] | strip }}{% endcapture %}
        {% capture image_100x %}{{ image[3] }}{% endcapture %}
        {% capture image_200x %}{{ image[4] }}{% endcapture %}
        {% capture image_400x %}{{ image[5] }}{% endcapture %}
        {% capture image_600x %}{{ image[6] }}{% endcapture %}
        {% capture image_800x %}{{ image[7] }}{% endcapture %}
        {% capture image_1200x %}{{ image[8] }}{% endcapture %}
        {% capture image_2000x %}{{ image[9] }}{% endcapture %}
        {% capture original_image_width %}{{- image[10] -}}{% endcapture %}
        {% capture original_image_height %}{{- image[11] -}}{% endcapture %}
        <div class="gallery-cell" data-thumb="{{ image_large }}" data-alt-tag="{{ image_alt }}" data-title="{% if image_alt contains 'youtube' or image_alt contains 'vimeo' %}{{ product.title }}{% else %}{{ image_alt | escape }}{% endif %}" data-image-height="{{ original_image_height | strip }}" data-image-width="{{ original_image_width | strip }}">
            {% if template != 'index' and section.settings.enable_product_lightbox %}
              <a href="{{ image_800x }}" class="lightbox" rel="gallery" data-fancybox-group="gallery" data-lightbox-zoom="{{ section.settings.activate_zoom }}" >
            {% endif %}
			{% if product.variants.size == 1 %}
                <div class="image__container" style="max-width: {{original_image_width}}">
                <img src="{{ image_100x }}"
                      alt="{{ image_alt | escape }}"
                      class="pdp-carousel-image lazyload {{ settings.image_loading_style }}"
                      data-index="{{ forloop.index0 }}"
                      data-image-id="{{ image_id }}"
                      data-sizes="auto"
                      data-src="{{ image_600x }}"
                      data-srcset=" {{ image_200x }} 200w,
                                    {{ image_400x }} 300w,
                                    {{ image_400x }} 400w,
                                    {{ image_600x }} 600w,
                                    {{ image_1200x }} 1000w"
                       />
              </div>
            {% endif %}
            {% if template != 'index' and section.settings.enable_product_lightbox %}
              </a>
            {% endif %}
        </div>
      {% endfor %}
  </div>
  <div class="carousel-reference-data" style="display: none;">
       {% for image in product.media %}
        {% assign image_id = image.id %}
        {% assign image_alt = image.alt %}
        {% assign image_100x = image | product_img_url: '100x' %}
        {% assign image_200x = image | product_img_url: '200x' %}
        {% assign image_400x = image | product_img_url: '400x' %}
        {% assign image_600x = image | product_img_url: '600x' %}
        {% assign image_800x = image | product_img_url: '800x' %}
        {% assign image_1200x = image | product_img_url: '1200x' %}
        {% assign image_2000x = image | product_img_url: '2000x' %}
        {% assign original_image_width = image.width %}
        {% assign original_image_height = image.height %}
        <div class="gallery-cell" data-thumb="{{ image_large }}" data-alt-tag="{{ image_alt }}" data-title="{% if image_alt contains 'youtube' or image_alt contains 'vimeo' %}{{ product.title }}{% else %}{{ image_alt | escape }}{% endif %}" data-image-height="{{ original_image_height | strip }}" data-image-width="{{ original_image_width | strip }}">
            {% if template != 'index' and section.settings.enable_product_lightbox %}
              <a href="{{ image_800x }}" class="lightbox" rel="gallery" data-fancybox-group="gallery" data-lightbox-zoom="{{ section.settings.activate_zoom }}" >
            {% endif %}
              <div class="image__container" style="max-width: {{original_image_width}}">
                {% if image.media_type == "image" %}
                <img 
                      src="{{ image_100x }}"
                     style="display: none; max-height: 400px"
                      alt="{{ image_alt | escape }}"
                      class="pdp-carousel-image lazyload {{ settings.image_loading_style }}"
                      data-index="{{ forloop.index0 }}"
                      data-image-id="{{ image_id }}"
                      data-sizes="auto"
                      data-src="{{ image_600x }}"
                      data-srcset=" {{ image_200x }} 200w,
                                    {{ image_400x }} 300w,
                                    {{ image_400x }} 400w,
                                    {{ image_600x }} 600w,
                                    {{ image_600x }} 1000w"
                       />
                {% elsif image.media_type == "video" %}
                  <div>
                  {{ image | video_tag: controls: true, image_size: "612x", onplay: "productGalleryOnPlay(this)", onpause: "productGalleryOnPause(this)" }}
                  <div class="video-play-button" onclick="productVideoPlay(this)"></div>
                  </div>

                {% else %}
                {% endif %}
              </div>
            {% if template != 'index' and section.settings.enable_product_lightbox %}
              </a>
            {% endif %}
        </div>
      {% endfor %}
  </div>
</div>

{% if product.id == 10668353350 %}
<script>
  var squareThumbnails = window.experimentPDPNewAssets;
  if(squareThumbnails) document.getElementsByClassName('gallery-wrap')[0].classList.add('square-thumbnails');
  function productGalleryOnPlay(videoElement){
    var video = $(videoElement)
    $(video).parent().find('.video-play-button').fadeOut();
  }

  function productGalleryOnPause(videoElement){
    var video = $(videoElement)
    $(video).parent().find('.video-play-button').fadeIn();
  }

  function productVideoPlay(button){
    $(button).parent().find('video').trigger('play');
  }
  

</script>
{% else %}
{% endif %}